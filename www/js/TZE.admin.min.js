/*!
 * Script für TZE (0.1.0) - Erstellt am 21-07-2015
 *
 * Copyright (c) 2015, Johannes Boost <jjjb at usw-tools.de>
 * 
 * Lizenziert unter: Creative Commons Lizenzvertrag - CC-BY-NC-SA-3.0
 * Namensnennung - Nicht-kommerziell - Weitergabe unter gleichen Bedingungen
 * http://creativecommons.org/licenses/by-nc-sa/3.0/de/legalcode
 */
function getOptions(a,b){var c=[];return $.ajax({url:a,type:"POST",dataType:"json",async:!1,data:b,success:function(a){c=a.Options}}),c}function actionFunc(a,b,c,d,e){function f(a,b){void 0!==b&&$.each(b,function(b,c){$.each(a,function(a,b){a===c.key&&$(c.element).data(a,b)})})}return $.each([c,d],function(a,c){if(void 0!==c){var d=$.param(c);d.length>0&&(b+="&"+d)}}),$.Deferred(function(c){$.ajax({url:a,type:"POST",dataType:"json",data:b,success:function(a){f(a,e),c.resolve(a)},error:function(){c.reject()}})})}var dispocodes=function(a){var b={};return b.init=function(b){this.jtable=a(b);var c=this.jtable;c.jtable({title:"&nbsp;",sorting:!0,fields:{id:{key:!0,list:!1},code:{title:"Nummer"},ListLabel:{title:"Name für Liste"},ButtonLabel:{title:"Name für Button"},"class":{title:"Klasse"},position:{list:!1,title:"Rangfolge"},usual:{list:!1,title:"Gruppe",type:"combobox",options:{1:"Übliche Liste",0:"Versteckte Liste"}}},actions:{listAction:function(a,b){return actionFunc("func/dispocodes.php","mode=admin&action=list&",b)},createAction:function(a){return actionFunc("func/dispocodes.php","mode=admin&action=insert&"+a)},updateAction:function(a){return actionFunc("func/dispocodes.php","mode=admin&action=update&"+a)},deleteAction:function(a){return actionFunc("func/dispocodes.php","mode=admin&action=delete&id="+a.id)}}}).jtable("load")},b.destroy=function(){this.jtable.jtable("destroy"),delete this.jtable},b}(jQuery),mitarbeiter=function(a){var b={};return b.init=function(){b.table=a("#mitarbeiter"),b.table.jtable({title:"&nbsp;",sorting:!0,defaultSorting:"sNachname ASC",paging:!0,pageSizes:[10,20,50,100],pageSize:20,actions:{listAction:function(a,b){return actionFunc("func/mitarbeiter.php","mode=admin&action=list&",b,a)},createAction:function(a){return actionFunc("func/mitarbeiter.php","mode=admin&action=insert&"+a)},updateAction:function(a){return actionFunc("func/mitarbeiter.php","mode=admin&action=update&"+a)},deleteAction:function(a){return actionFunc("func/mitarbeiter.php","mode=admin&action=delete&userId="+a.userId)}},fields:{userId:{key:!0,list:!1},maId:{title:"Kürzel",inputClass:"validate[required]"},sVorname:{title:"Vorname",inputClass:"validate[required]"},sNachname:{title:"Nachname",inputClass:"validate[required]"},sLogin:{title:"Login",inputClass:"validate[required]"},sMail:{title:"E-Mail",inputClass:"validate[required]"},iArbeitszeit:{title:"AZ",inputClass:"validate[required]"},bZeitarbeiter:{title:"Leih-A.",type:"combobox",options:{0:"Nein",1:"Ja"}},bLogin_Allowed:{title:"Freig.",type:"combobox",options:{0:"Nein",1:"Ja"}},iAdmin:{title:"Zugriff",type:"combobox",options:{0:"Nutzer",1:"Admin"}},sPassword_hash:{title:"Passwort",list:!1,create:!1,type:"checkbox",values:{"":"keine Änderung",neuespw:"Neues Passwort vergeben"}},bForce_Update_PW:{create:!1,list:!1,title:"Muss neues Passwort erstellen?",type:"checkbox",values:{0:"Nein",1:"Ja"}}},formCreated:function(a,b){},formSubmitting:function(a,b){},formClosed:function(a,b){},recordUpdated:function(a,b){if("undefined"!=typeof b.serverResponse.Password){var c="Hallo "+b.record.sVorname+",\n\nhiermit erhältst du dein Login für unsere Zeiterfassung:\n\nLogin:\n"+b.record.sLogin+"\n\nPasswort:\n"+b.serverResponse.Password+"\n\nDie Zeiterfassung erreichst du unter folgender Adresse:\nhttps://"+window.location.hostname+"/\n\nBitte beachte, dass die Seite erst ab Version 10 des Internet Explorers korrekt angezeigt wird, eventuell musst du also einen anderen Browser verwenden.",d=encodeURI(c),e=encodeURI("Login für Zeiterfassung");bootbox.alert({title:"Neuer Passwort",message:"<p>Für "+b.record.sVorname+" "+b.record.sNachname+' wurde ein neues Passwort erstellt.</p><div class="alert alert-info"><strong>Hinweis:</strong> Passwort muss beim nächsten Login geändert werden!</div><div class="form-group"><label>Login</label><pre>'+b.record.sLogin+'</pre></div><div class="form-group"><label>Passwort</label><pre>'+b.serverResponse.Password+'</pre></div><p><a href="mailto:'+b.record.sMail+"?subject="+e+"&body="+d+'" target="_blank">Per E-Mail versenden</a></p>'})}},recordAdded:function(a,b){var c="Hallo "+b.record.sVorname+",\n\nhiermit erhältst du dein Login für unsere Zeiterfassung:\n\nLogin:\n"+b.record.sLogin+"\n\nPasswort:\n"+b.serverResponse.Password+"\n\nDie Zeiterfassung erreichst du unter folgender Adresse:\nhttps://"+window.location.hostname+"/\n\nBitte beachte, dass die Seite erst ab Version 10 des Internet Explorers korrekt angezeigt wird, eventuell musst du also einen anderen Browser verwenden.",d=encodeURI(c),e=encodeURI("Login für Zeiterfassung");bootbox.alert({title:"Neuer Mitarbeiter",message:"<p>Das Login für "+b.record.sVorname+" "+b.record.sNachname+' wurde erstellt.</p><div class="alert alert-info"><strong>Hinweis:</strong> Passwort muss beim nächsten Login geändert werden!</div><div class="form-group"><label>Login</label><pre>'+b.record.sLogin+'</pre></div><div class="form-group"><label>Passwort</label><pre>'+b.serverResponse.Password+'</pre></div><p><a href="mailto:'+b.record.sMail+"?subject="+e+"&body="+d+'" target="_blank">Per E-Mail versenden</a></p>'})},toolbar:{items:[{text:'Filter: <input id="nameFilter" name="nameFilter" style="width: 6em; margin: -5px 0px; border: none;" type="text" />'},{text:'<span name="undelete">gelöschte Mitarbeiter<span>'}]}}),a("#mitarbeiter").on("keydown",'input[name="nameFilter"]',function(){void 0!==b.updateTimer&&clearTimeout(b.updateTimer);var c=a(this);b.updateTimer=setTimeout(function(){delete b.updateTimer,b.table.jtable("load",{nameFilter:c.val()})},400)}),a("#mitarbeiter").on("click",'span[name="undelete"]',function(){var c=tze.showProcess();a.post("func/mitarbeiter.php",{mode:"admin",action:"list-deleted"},function(d){if(tze.hideProcess(c,!0),"OK"===d.Result){var e=a('<select name="undelSelection" class="form-control"></select>'),f=a('<div class="col-sm-8"></div>').append(e),g=a('<div class="form-group"></div>').append("<div class='col-sm-4 control-label'>Gelöschte Mitarbeiter</div>").append(f),h=a('<form class="form-horizontal"></form>').append(g);e.append('<option style="display: none;">bitte auswählen</option>'),a.each(d.Records,function(){e.append('<option value="'+this.userId+'">'+this.name+"</option>")}),bootbox.confirm({title:"Mitarbeiter wiederherstellen",message:h,closeButton:!1,animate:!1,backdrop:!0,callback:function(c){if(c){var d=a('select[name="undelSelection"]').val();""!==d&&a.post("func/mitarbeiter.php",{mode:"admin",action:"undelete",userId:d},function(a){"OK"===a.Result?b.table.jtable("reload"):void 0!==a.Message&&bootbox.alert(a.Message)},"json")}}})}else void 0!==d.Message&&bootbox.alert(d.Result)},"json")})},b}(jQuery),projekte=function(a){var b={};return b.init=function(){a("#projekte").jtable({openChildAsAccordion:!0,title:"&nbsp;",fields:{id:{key:!0,list:!1},Projekt:{title:"Projekte"},MA:{create:!1,edit:!1,display:function(b){var c=a('<button style="width: 100%">zugeordnete Mitarbeiter</button>');return c.on("click",function(){a("#projekte").jtable("openChildTable",c.closest("tr"),{title:b.record.Projekt+" - zugeordnete Mitarbeiter",fields:{iUser:{key:!0,list:!1,title:"Mitarbeiter",create:!0,options:getOptions("func/projekte.php","mode=admin&action=projekt-get-users-detached&id="+b.record.id)},sVorname:{title:"Vorname",create:!1},sNachname:{title:"Nachname",create:!1},sLogin:{title:"Login",create:!1}},actions:{listAction:function(){return actionFunc("func/projekte.php","mode=admin&action=projekt-get-users-attached&id="+b.record.id)},createAction:function(a){return actionFunc("func/projekte.php","mode=admin&action=projekt-add-user&data=json&id="+b.record.id+"&"+a)},deleteAction:function(a){return actionFunc("func/projekte.php","mode=admin&action=projekt-del-user&data=json&id="+b.record.id+"&iUser="+a.iUser)}}},function(a){a.childTable.jtable("load")})}),c}},Tickets:{create:!1,edit:!1,display:function(b){var c=a('<button style="width: 100%">Ticketarten</button>');return c.on("click",function(){a("#projekte").jtable("openChildTable",c.closest("tr"),{title:b.record.Projekt+" - Ticketarten",fields:{ticketId:{key:!0,list:!1},ticketName:{title:"Name"},undoneSwitch:{title:"Abschluss",options:{0:"Immer",1:"Wählbar"}},ticketNumberSwitch:{title:"Ticketnummer",options:{1:"keine",2:"Optional",3:"Erforderlich"}},counterSwitch:{title:"Anzahl",options:{1:"keine",2:"Optional",3:"Erforderlich"}},counterName:{title:"Name für Anzahl"},durationSwitch:{title:"Dauer",options:{1:"keine",2:"Optional",3:"Erforderlich"}},shortcut:{title:"Taste"},charge_ticket:{title:"€/Ticket"},charge_counter:{title:"€/Anzahl"},charge_duration:{title:"€/Minute"}},actions:{listAction:function(){return actionFunc("func/projekte.php","mode=admin&action=projekt-ticket-list&projektId="+b.record.id)},createAction:function(a){return actionFunc("func/projekte.php","mode=admin&action=projekt-ticket-create&projektId="+b.record.id+"&"+a)},updateAction:function(a){return actionFunc("func/projekte.php","mode=admin&action=projekt-ticket-update&projektId="+b.record.id+"&"+a)},deleteAction:function(a){return actionFunc("func/projekte.php","mode=admin&action=projekt-ticket-delete&projektId="+b.record.id+"&ticketId="+a.ticketId)}}},function(a){a.childTable.jtable("load")})}),c}}},actions:{listAction:function(){return actionFunc("func/projekte.php","mode=admin&action=projekt-list")},updateAction:function(a){return actionFunc("func/projekte.php","mode=admin&action=projekt-set-name&"+a)},deleteAction:function(a){return actionFunc("func/projekte.php","mode=admin&action=projekt-delete&id="+a.id)},createAction:function(a){return actionFunc("func/projekte.php","mode=admin&action=projekt-create&"+a)}}})},b}(jQuery),tickets=function(a){var b={};return b.filter={},b.init=function(c,d){this.$jtable=a(c),this.$datepicker=a(d);var e=this.$jtable,f=this.$datepicker;f.datepicker({dateFormat:"yy-mm-dd"}).on("change",function(){a.extend(b.filter,{Date:a(this).val()}),e.jtable("load",b.filter)}),e.jtable({title:"&nbsp;",fields:{id:{key:!0,list:!1},Projekt:{title:"Projekt",width:"30%"},Tickets:{title:"Zusammenfassung",width:"43%",display:function(a){var b=a.record.charge_tickets,c=a.record.done_tickets,d=a.record.sum_counter,e=a.record.sum_duration;return"Tickets: "+b+" (Gesamt: "+c+", Einheiten: "+d+", Zeit: "+e+")"}},perMA:{title:"",width:"12%",display:function(c){var d=a("<button>per MA</button>");return d.on("click",function(){b.childperMA(d,c.record)}),d}},perTA:{title:"",width:"15%",display:function(c){var d=a("<button>per Ticket</button>");return d.on("click",function(){b.childperTA(d,c.record)}),d}}},actions:{listAction:function(a,b){return actionFunc("func/tickets.php","mode=admin&action=list",b,a)}},toolbar:{items:[{text:'<div><span class="glyphicon glyphicon-refresh"></span> Aktualisieren</div>',click:function(){e.jtable("reload")}},{text:'<div><span class="glyphicon glyphicon-download-alt"></span> Excel-Report</div>',click:function(){b.Report(f.val())}}]}}).jtable("load")},b.Report=function(b){tze.showProcess(),a.ajax({url:"func/report_tickets.php",data:{Date:b,mode:"admin"},type:"POST",dataType:"binary",success:function(b,c,d){var e=d.getResponseHeader("Content-Disposition").replace("attachment;filename=","");if(navigator.userAgent.match(/Trident/))tze.hideProcess(),window.navigator.msSaveOrOpenBlob(b,e);else{var f=window.URL.createObjectURL(b),g=a("<a />",{"class":"text-center btn btn-default",id:"reportDownload",href:f,download:e,text:"Download starten"});a(document).one("click","a#reportDownload",function(){setTimeout(function(){window.URL.revokeObjectURL(f)},1e3)}),g.hide().appendTo("body")[0].click(),tze.hideProcess()}}})},b.childperTA=function(b,c,d){var e=c.id,f=c.userId||d?d.userId:void 0,g=a.param({id:e,userId:f});this.$jtable.jtable("openChildTable",b.closest("tr"),{title:"Aufstellung nach Tickets",fields:{ticketId:{},done_tickets:{},sum_counter:{},sum_duration:{}},actions:{listAction:function(){return actionFunc("func/tickets.php","mode=admin&action=list-ticket-classes&"+g)}}},function(a){a.childTable.jtable("load")})},b.childperMA=function(c,d){var e=a.param({id:d.id});this.$jtable.jtable("openChildTable",c.closest("tr"),{title:"Aufstellung nach Mitarbeiter",fields:{userId:{key:!0,list:!1},sVorname:{title:"Vorname",width:"25%"},sNachname:{title:"Nachname",width:"25%"},Tickets:{title:"Zusammenfassung",width:"35%"},perTA:{title:"",width:"15%",display:function(c){var e=a("<button>per Ticket</button>");return e.on("click",function(){b.childperTA(e,c,d)}),e}}},actions:{listAction:function(){return actionFunc("func/tickets.php","mode=admin&action=list-ma&"+e)}}},function(a){a.childTable.jtable("load")})},b.destroy=function(){this.$jtable.jtable("destroy")},b}(jQuery),zeiterfassung=function(a){function b(b,f,g){var h,i,j,k=moment(b),l="HH:mm:ss",m="DD.MM.YYYY",n="YYYY-MM.DD HH:mm:ss";if(k.isValid())i=k.format(l),j=k.format(m),h=b;else if(g)i="offen",j="",h="0000-00-00 00:00:00";else{var o=e.$datepicker.val();i=moment().format(l),j=moment(o).format(m),h=o+" "+i}var p=a('<input type="hidden" name="'+f+'" value="'+h+'">'),q=a('<div class="input-group"></div>'),r=a('<input class="form-control" type="text" value="'+i+'">'),s=a('<span class="input-group-btn"><span class="btn btn-default"><span class="glyphicon glyphicon-time"></span></span></span>'),t=a('<div class="input-group"></div>'),u=a('<input class="form-control" type="text" value="'+j+'">'),v=a('<span class="input-group-btn"><span class="btn btn-default"><span class="glyphicon glyphicon-calendar"></span></span></span>');q.append(r,s),q.datetimepicker({widgetPositioning:{vertical:"top"},showClose:!1,keepInvalid:!0,format:l}),t.append(u,v),t.datetimepicker({widgetPositioning:{vertical:"top"},showClose:!1,keepInvalid:!0,format:m}),r.on("input change",function(){var b=moment(u.val(),m),d=moment(a(this).val(),l);c(d,b,p,r,u)}),q.on("dp.show",function(){var b=q.data("DateTimePicker"),c=moment(a("#Edit-Time_Start > input[name='Time_Start']").val(),n),d=moment(a("#Edit-Time_End > input[name='Time_End']").val(),n),e=moment(a(this).closest(".row").children("input:hidden").val(),n);b.date(e),g?(b.minDate(c),(d.isBefore(c)||!d.isValid())&&b.date(c)):(b.maxDate(d),(c.isAfter(d)||!c.isValid())&&b.date(d))}),t.on("dp.show",function(){var b=t.data("DateTimePicker"),c=moment(a("#Edit-Time_Start > input[name='Time_Start']").val(),n),d=moment(a("#Edit-Time_End > input[name='Time_End']").val(),n),e=moment(a(this).closest(".row").children("input:hidden").val(),n);b.date(e),g?(b.minDate(c),(d.isBefore(c)||!d.isValid())&&b.date(c)):(b.maxDate(d),(c.isAfter(d)||!c.isValid())&&b.date(d))}),q.on("dp.update dp.change change",function(a){var b=moment(u.val(),m);c(a.date,b,p,r,u)}),u.on("input change",function(){var b=moment(a(this).val(),m),c=moment(r.val(),l);d(b,c,p,r,u)}),t.on("dp.update dp.change change",function(a){var b=moment(r.val(),l);d(a.date,b,p,r,u)});var w="";g&&(w=a('<button type="button" class="btn btn-default">Offen</button>'),w.on("click",function(a){q.data("DateTimePicker").hide(),t.data("DateTimePicker").hide(),p.val("0000-00-00 00:00:00"),u.val(""),r.val("offen")}));var x=a("<div class='row'></div>"),y=a('<div class="col-sm-2"></div>'),z=a('<div class="col-sm-5"></div>'),A=a('<div class="col-sm-5"></div>');return x.append(p,y,z,A),y.append(w),z.append(t),A.append(q),x}function c(a,b,c,d,f){b.isValid()||(b=moment(e.$datepicker.val())),b.hour(a.hour()),b.minute(a.minute()),b.second(a.second()),c.val(b.format("YYYY-MM-DD HH:mm:ss")),d.val(b.format("HH:mm:ss")),f.val(b.format("DD.MM.YYYY"))}function d(a,b,c,d,f){b.isValid()||(b=moment(e.$datepicker.val())),b.year(a.year()),b.month(a.month()),b.date(a.date()),c.val(b.format("YYYY-MM-DD HH:mm:ss")),d.val(b.format("HH:mm:ss")),f.val(b.format("DD.MM.YYYY"))}var e={};return e.autoUpdate=function(){if(a.active>0)a(document).one("ajaxStop",function(){e.autoUpdate()});else{var b=a("#filter").data(),c=a.param({mode:"admin",action:"get-users-update",last:b.last});if(void 0!==b.filter){var d=a.param(b.filter);d.length>0&&(c+="&"+d)}e.updateRequest=a.post("func/zeiterfassung.php",c,function(b){if(delete e.updateRequest,"OK"===b.Result){a("#filter").data("last",b.last),a.each(b.Records,function(){e.updateRow(this)});var c=a("#autoreload").prop("checked");c&&(e.autoUpdateTimer=setTimeout(function(){e.autoUpdate()},2e3))}},"json")}},e.datepicker=function(b){e.$datepicker=a(b);var c=e.$datepicker;e.$jtable&&c.datepicker({dateFormat:"yy-mm-dd"}).on("change",function(){var b=a("#filter").data("filter")||{};e.$jtable.jtable("load",b)})},e.filter={projektFilterInit:function(b){e.filter.$liste=a(b);var c=e.filter.$liste;c.on("show.bs.collapse",function(b){c.empty().append("<span class='wait text-muted'>Lädt...&nbsp;<span class='glyphicon glyphicon-refresh glyphicon-spin'></span></span>"),a.post("func/projekte.php",{mode:"admin",action:"projekt-list"},function(b){"OK"===b.Result?(c.empty(),a.each(b.Records,function(b,d){var e=a('<a href="#zeiterfassung" class="filter list-group-item"></a>');e.text(d.Projekt).data("filter",{filter:"Projekt",filterId:d.id}),c.append(e)})):c.empty().append("Es ist Fehler aufgetreten!")},"json")})},reset:function(){a("#filter").removeData("filter");var b=e.filter.$liste||!1;b&&b.collapse("hide"),a.each(e.filter.toggleElements,function(b,c){var d=a(c);d.removeClass("active");var e=d.data("filter")||!1;e&&e.toggleProp&&delete e[e.toggleProp]}),a('input[name="nameFilter"]').val("")},toggleElements:["#filter a[href=#loggedOnly]"],settings:{}},e.init=function(c,d,f){e.$jtable=a(d);var g=this.$jtable;e.datepicker(f),g.jtable({title:"&nbsp;",openChildAsAccordion:!0,fields:{iUserID:{key:!0,list:!1},sVorname:{title:"Vorname",width:"25%"},sNachname:{title:"Nachname",width:"25%"},AZ:{title:"Arbeit",width:"10%",display:function(a){var b=a.record.AZ||"",c="";return 1===a.record.working&&(c="clockme"),'<time class="'+c+'">'+b+"</time>"}},PZ:{title:"Pause",width:"10%",display:function(a){var b=a.record.PZ||"",c="";return 0===a.record.working&&(c="clockme"),'<time class="'+c+'">'+b+"</time>"}},Projekt:{title:"Projekt",width:"15%"},Status:{title:"Status",width:"10%"},Details:{width:"5%",sorting:!1,display:function(c){var d=a("<button>Details</button>");return d.on("click",function(){g.jtable("openChildTable",d.closest("tr"),{sorting:!0,defaultSorting:"Time_Start ASC",title:"Detailansicht - "+c.record.sVorname+" "+c.record.sNachname,fields:{id:{key:!0,list:!1},iProjekt:{title:"Projekt",list:!1,type:"combobox",options:getOptions("func/zeiterfassung.php","mode=admin&action=get-users-projekts&iUserId="+c.record.iUserID)},iCat:{title:"Art",list:!1,type:"combobox",options:getOptions("func/zeiterfassung.php","mode=admin&action=get-users-classes&iUserId="+c.record.iUserID)},Eintrag:{title:"Eintrag",create:!1,edit:!1,width:"55%",display:function(a){return a.record.Projekt+" "+a.record.ListLabel}},Time_Start:{title:"von",width:"15%",display:function(a){return a.record.Time_Start.substr(-8)},input:function(a){var c=a.record?a.record.Time_Start:!1;return b(c,"Time_Start",!1)}},Time_End:{title:"bis",width:"15%",display:function(a){var b=a.record.Time_End.substr(-8);return"00:00:00"===b&&(b="offen"),b},input:function(a){var c=a.record?a.record.Time_End:!1;return b(c,"Time_End",!0)}},Duration:{title:"Dauer",width:"15%",create:!1,edit:!1}},actions:{listAction:function(){var b=a("#datepicker").val();return actionFunc("func/zeiterfassung.php","mode=admin&action=get-users-timetable&Date="+b+"&iUserID="+c.record.iUserID)},createAction:function(b){var d=a("#datepicker").val();return actionFunc("func/zeiterfassung.php","mode=admin&action=insert-users-timetable&Date="+d+"&iUserID="+c.record.iUserID+"&"+b)},updateAction:function(a){return actionFunc("func/zeiterfassung.php","mode=admin&action=update-users-timetable&"+a)},deleteAction:function(a){return actionFunc("func/zeiterfassung.php","mode=admin&action=delete-users-timetable&id="+a.id)}},rowInserted:function(b,c){"Pause"===c.record.ListLabel&&a(c.row).addClass("info").closest("table").addClass("table"),"Meeting"===c.record.ListLabel&&a(c.row).addClass("danger").closest("table").addClass("table"),"Sonstiges"===c.record.ListLabel&&a(c.row).addClass("warning").closest("table").addClass("table")},rowUpdated:function(b,c){"Pause"===c.record.ListLabel?a(c.row).addClass("info").removeClass("danger warning").closest("table").addClass("table"):"Meeting"===c.record.ListLabel?a(c.row).addClass("danger").removeClass("info warning").closest("table").addClass("table"):"Sonstiges"===c.record.ListLabel?a(c.row).addClass("warning").removeClass("danger info").closest("table").addClass("table"):a(c.row).removeClass("warning danger info").closest("table").addClass("table")}},function(a){a.childTable.jtable("load")})}),d}}},actions:{listAction:function(b,c){return actionFunc("func/zeiterfassung.php","mode=admin&action=get-users&Date="+a("#datepicker").val(),c,b,[{key:"last",element:"#filter"}])}},toolbar:{items:[{text:'Filter: <input id="nameFilter" name="nameFilter" style="width: 6em; margin: -5px 0px; border: none;" type="text" />'},{text:'<div><input id="autoreload" style="margin: 0;" type="checkbox" /><span class="hidden glyphicon glyphicon-refresh"></span> AutoUpdate</div>',click:function(){e.toggleUpdater()}},{text:'<div><span class="glyphicon glyphicon-refresh"></span> Aktualisieren</div>',click:function(){g.jtable("reload")}},{text:'<div><span class="glyphicon glyphicon-download-alt"></span> Excel-Report</div>',click:function(){var a=e.$datepicker.val();zeiterfassung.Report(a)}}]},rowInserted:function(b,c){null===c.record.AZ&&a(c.row).addClass("danger").closest("table").addClass("table"),"Pause"===c.record.Status&&a(c.row).addClass("info").closest("table").addClass("table"),"Meeting"===c.record.Status&&a(c.row).addClass("warning").closest("table").addClass("table")},loadingAnimationDelay:100,sorting:!0}).jtable("load"),a("a[href=#loggedOnly]").data("filter",{toggleProp:"loggedOnly"}),a("#zeiterfassung").on("click","a.filter",function(b){b.preventDefault();var c=a("#filter").data("filter")||a("#filter").data("filter",{}).data("filter"),d=a(this),f=d.data("filter")||!1;f?(f.toggleProp?(f[f.toggleProp]=!f[f.toggleProp],f[f.toggleProp]?d.addClass("active"):d.removeClass("active")):d.addClass("active").siblings().removeClass("active"),a.extend(c,f),delete c.toggleProp):(e.filter.reset(),c={},d.siblings().removeClass("active").children().removeClass("active")),g.jtable("load",c)}),a("#zeiterfassung").on("keydown",'input[name="nameFilter"]',function(){var b=a(this);e.updateTimer&&clearTimeout(e.updateTimer),e.updateTimer=setTimeout(function(){var c=a("#filter").data("filter")||a("#filter").data("filter",{}).data("filter");c.nameFilter=b.val(),g.jtable("load",c)},400)})},e.Report=function(b){tze.showProcess(),a.ajax({url:"func/report.php",data:{Date:b,mode:"admin"},type:"POST",dataType:"binary",success:function(b,c,d){var e=d.getResponseHeader("Content-Disposition").replace("attachment;filename=","");if(navigator.userAgent.match(/Trident/))tze.hideProcess(),window.navigator.msSaveOrOpenBlob(b,e);else{var f=window.URL.createObjectURL(b),g=a("<a />",{"class":"text-center btn btn-default",id:"reportDownload",href:f,download:e,text:"Download starten"});a(document).one("click","a#reportDownload",function(){setTimeout(function(){window.URL.revokeObjectURL(f)},1e3)}),g.hide().appendTo("body")[0].click(),tze.hideProcess()}}})},e.toggleUpdater=function(){clearTimeout(e.timeout),e.timeout=setTimeout(function(){var b=a("#autoreload").data("checked");b=void 0!==b?b:!1,b?(console.log("AutoUpdate deaktiviert"),clearTimeout(e.autoUpdateTimer),void 0!==e.updateRequest&&e.updateRequest.abort(),a("#autoreload").data("checked",!1),a("#autoreload").prop("checked",!1)):(console.log("AutoUpdate aktiviert"),e.autoUpdate(),a("#autoreload").data("checked",!0),a("#autoreload").prop("checked",!0))},100)},e.updateRow=function(a){this.jtable.jtable("updateRecord",{record:a,clientOnly:!0})},e}(jQuery);$(document).ready(function(){$('a[data-toggle="tab"]').on("show.bs.tab",function(a){window.location.href=$(a.target).attr("href"),"#mitarbeiter"===$(a.target).attr("href")?(mitarbeiter.init(),$("#mitarbeiter").jtable("load")):"#mitarbeiter"===$(a.relatedTarget).attr("href")&&$("#mitarbeiter").jtable("destroy"),"#projekte"===$(a.target).attr("href")?(projekte.init(),$("#projekte").jtable("load")):"#projekte"===$(a.relatedTarget).attr("href")&&$("#projekte").jtable("destroy"),"#zugriff"===$(a.target).attr("href")?$("#zugriff").jtable({title:"&nbsp;",fields:{id:{key:!0,list:!1},name:{title:"Name"},ip_range:{title:"IP-Range"}},actions:{listAction:function(){return actionFunc("func/ip_range.php","mode=admin&action=list")},updateAction:function(a){return actionFunc("func/ip_range.php","mode=admin&action=update&"+a)},deleteAction:function(a){return actionFunc("func/ip_range.php","mode=admin&action=delete&id="+a.id)},createAction:function(a){return actionFunc("func/ip_range.php","mode=admin&action=create&"+a)}}}).jtable("load"):"#zugriff"===$(a.relatedTarget).attr("href")&&$("#zugriff").jtable("destroy"),"#zeiterfassung"===$(a.target).attr("href")?(zeiterfassung.init("#zeiterfassung","#jtable_ZE","#datepicker"),zeiterfassung.filter.projektFilterInit("#projekt-toggle")):"#zeiterfassung"===$(a.relatedTarget).attr("href")&&$("#jtable_ZE").jtable("destroy"),"#tickets"===$(a.target).attr("href")?tickets.init("#jtable_Tickets","#datepicker_tickets"):"#tickets"===$(a.relatedTarget).attr("href")&&tickets.destroy(),"#dispocodes"===$(a.target).attr("href")?dispocodes.init("#dispocodes"):"#dispocodes"===$(a.relatedTarget).attr("href")&&dispocodes.destroy()});var a=$(location).attr("hash").split("/");if(""!==a[0])try{$("a[href="+a[0]+"]").tab("show")}catch(b){var c='<div class="alert alert-warning alert-dismissible"><button type="button" class="close" data-dismiss="alert" aria-label="Schließen"><span aria-hidden="true">&times;</span></button><strong>Hinweis:</strong> Die Unterseite <span class="text-info">'+a[0]+"</span> konnte nicht aufgerufen werden!</div>";$("#main").prepend(c)}$(".m-app-loading").fadeOut(function(){$(".m-app-loading").remove()})});